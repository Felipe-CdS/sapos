<div class="content">
  <div class="active-scaffold default-theme">
    <div class="active-scaffold-header">
      <h2><%= @admission_process.title %></h2>
    </div>
    <div class="admission-inner">
      <%= form_with model: @admission_application,
          scope: :record,
          url: @submission_url,
          method: @submission_method,
          class: "as_form create",
          authenticity_token: true,
          multipart: true do |form| %>
        <h4> <%= t "admissions.apply.edit.title" %> </h4>
        <div class="messages-container">
          <% count = @admission_application.errors.count + (flash[:alert].present? ? 1 : 0) %>
          <% if count > 0 %>
            <div id="errorExplanation" class="errorExplanation">
              <h2><%= t("errors.admissions.invalid_basic", count: count) %></h2>
              <p><%= t "errors.template.body" %></p>
              <ul>
                <% if flash[:alert] %>
                  <li><%= flash[:alert] %></li>
                <% end %>
                <% @admission_application.errors.each do |error| %>
                  <li>
                    <% if error.attribute.start_with? "filled_form.fields" %>
                      <%= error.message %>
                    <% else %>
                      <%= error.full_message %></li>
                    <% end %>
                  </li>
                <% end %>
              </ul>
            </div>
          <% end %>
        </div>
        <%= render partial: "admissions/filled_form/edit/form_with_letters", locals: {
          form: form,
          admission_process: @admission_process,
          admission_application: @admission_application,
          show_name: @show_name,
          show_email: @show_email } %>
        <p class="form-footer">
          <%= form.submit (t "admissions.apply.edit.submit"), id: "submit" %>
        </p>
      <% end %>
    </div>
  </div>
</div>

<script>
  $(document).ready(function() {
    $("#submit").click(function(e){
      window.onbeforeunload = null;
      for (let validation of window.customFormValidations) {
        if (!validation()) {
          e.preventDefault();
          return false;
        }
      }
    })
  });
</script>
